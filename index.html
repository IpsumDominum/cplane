<style>
    #pane_normal_plot,#pane_bifurcation{
        margin-top:10px;
        width:480px;
        display:flex;
        flex-direction: column;
        padding:10px 10px 10px 10px;
        border-radius:0px;
        box-shadow: none;
        border:none;
        background:none;
    }
    #numeric_functions{
        width:480px !important;
        display:none;
        padding:10px 10px 10px 10px;
        border-left:none;
        border-radius: 0px;
        box-shadow: none;
        padding-left: 20px;
        margin-left:-300px;
        z-index: -3;
        transition: all 1s;
    }
    .move_left_anim{
        margin-left:-300px !important;
    }
    .move_right_anim{
        margin-left:-10px !important;
    }
    .move_down_anim{
        transform: scale(1,1);
    }
    .move_up_anim{
        transform: scale(0,0);
    }
    
    #main_functions{
        justify-items: center;
        justify-content: center;
        align-content: center;
        align-items: center;
        padding-left:50px;
        transform-origin: top left;
    }
    #numeric_functions input{
        margin-top:3px;
        margin-bottom:3px;
    }
    #show_more_options_button{
        display: flex;
        align-content: center;
        align-items: center;
        justify-content: center;
        text-align: center;
        text-justify: center;
        padding-left:5px;
        padding-right:5px;
        box-shadow: none;
        padding-bottom:5px;
        padding-top:5px;
        z-index: 100;
        width:50px;
        cursor: pointer;
        font-size: 80%;
        margin-right:5px;
        border:white solid 2px;
        -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
    }
    #show_more_options_button:hover{
        background:gray;
        color:white;
        border: gray solid 2px;
    }
    #main_pane{
        width:500px;
        height:250px;
        margin-top:50px;
        display:flex;
        flex-direction:row;
        padding:10px 10px 10px 10px;
        position:absolute;
        left:-445px;
        top:-40px;
        z-index: 10;
        font-size:13px;
        transition: all 0.1s;
        transform-origin: top left;
        opacity: 0.95;
        -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
    }
        .smooth-borders{
    background:  #fcfcfc;
      border: 1px solid #d1d1d1;
      font: bold 10px Arial,Helvetica,Sans-serif;
      -webkit-border-radius: 20px;
      -moz-border-radius: 20px;
      border-radius: 8px;
      color:#5f5f5f; 
      -webkit-border-radius: 20px;
      -moz-border-radius: 20px;
      border-radius: 8px;
      text-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
      -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15) ;
      -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15) ;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15) ;
  }


  input,button,select,textarea,canvas,checkbox{
    background:  #fcfcfc;
    border: 1px solid #d1d1d1;
    font: bold 10px Arial,Helvetica,Sans-serif;
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    border-radius: 8px;
    color:#5f5f5f; 
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    border-radius: 8px;
    text-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
    -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15) ;
    -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15) ;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15) ; 
    padding:5px 5px 5px 5px;     
  }

   button:hover{
    background:gray;
    color:white;    
}
    .active{
        background:green;
        color:white;
    }
    body{
        display:flex;
        flex-direction: column;
        position:relative;
        align-items: left;
    }
    #canvas_pane{
        position:absolute;
        left:0;
        top:0;
        margin-top:10px;
        background:white !important;
    }
    body{
        display:flex;
        flex-direction: column;
        position:relative;
        align-items: center;
    }
    /*@media only screen and (min-width: 1050px) {
    body{
        display:flex;
        flex-direction: row;
        position:relative;
        align-items: center;
    }
        #canvas_pane{
        position:relative;
        left:0;
        top:0;
        margin-top:10px;
        background:white !important;
    }
         #main_pane{
        width:500px;
        height:300px;
        display:flex;
        flex-direction:row;
        padding:10px 10px 10px 10px;
        position:relative;
        left:0;
        top:0;
        z-index: 10;
        font-size:13px;

    }
    
}*/
    #main_pane_wrapper{
        position:relative;
    }
    input{
        padding-left: 2px;
        padding-right: 2px;
    }
.input_small{
            width:45px !important;
        }
    .range{
        position: absolute;
        margin-top:-3px;
        width:100px;
    }
    select{
        border: 1px solid orange;
    }
</style>
<div style="display:flex;">
<div id="show_more_options_button" class="smooth-borders" onclick="toggle_show_more_options()" style="background: blue;color:white;">
        Show Options
        </div>
<div id="show_more_options_button" class="smooth-borders" onclick="clear_graph()" style="background: red;color:white;">
        Reset Graph
        </div>
<h1 style="font-family:fantasy;font-size:20px;">Yet Another Phase Plane Plotter</h1>
</div>

<!--Main Pane Wrapper-->
<div id="main_pane_wrapper">
<div id="main_pane" class="smooth-borders">
    <div id="main_functions" >
            Variables : 
            <br>
            <textarea id="variables" cols=52>
u=3;
            </textarea>
            <br>
            <br>
            <div class="2-container">
            <sup>dx</sup>&frasl;<sub>dt</sub>
 : <input id="x_eq" value="sin(y)*u">
            <sup>dy</sup>&frasl;<sub>dt</sub>
 : <input id="y_eq" value="sin(x)*u">
                </div>
            <br>
            <div class="2-container">
            X<sub>0</sub>: <input id="x_0" class="input_small" value=0>
            Y<sub>0</sub>: <input id="y_0" class="input_small" value=0>
            </div>
            <br>
            
            <div class="2-container" style="margin-top:-5px;">
            <select id="pane_select">
            <option value="normal_plot">Normal Plot</option>
            <option value="bifurcation">Bifurcation</option>
            </select>
            Step Size: <input id="step_size" type="text" class="input_small" value="0.001">
            Plot Amount: <input id="step_amount" type="range" class="range" value="20000" min="10" max="100000">
                <label id="step_amount_val" type="text" class="input_small" style="margin-left:110px;">20000</label>
            </div>
            <div id="pane_normal_plot" class="smooth-borders">
                <!------------------------------------>
                <div class="2-container" style="margin-bottom:5px;margin-top:-10px;">
                X<sub>min</sub>: <input id="x_min" class="input_small" value=-5>
                X<sub>max</sub>: <input id="x_max" class="input_small" value=5>
                Y<sub>min</sub>: <input id="y_min" class="input_small" value=-5>
                Y<sub>max</sub>: <input id="y_max" class="input_small" value=5>
                </div>
                <!------------------------------------>
                <div class="2-container" style="margin-bottom:5px;margin-left:-10px;">
                <label style="color:black;font-weight: bold;">ANIMATION MODE:</label> <input id="animation_mode_check" type="checkbox" checked="true">
                <button onclick="plot_from_initial_cond()">Plot from initial condition</button>
                <button id="mouse_mode_toggle" onclick="toggle_mouse_mode()">Initial Conditions From Mouse Click</button>
                </div>
                <!------------------------------------>
                <div class="2-container">
                    <label style="margin-left:-10px;">PLOT BOTH DIRECTIONS:</label> <input id="plot_both_directions" type="checkbox" checked="true">
                <button onclick="plot_null_clines(false)">Plot Null-Clines</button>
                <button id="mouse_mode_toggle" onclick="plot_null_clines(true)">Plot Equilibriums</button>
                <button id="mouse_mode_toggle" onclick="show_dynamics_grid()">Show Dynamics Grid</button>
                </div>
                
                
            </div>

            <!-------------------BIFURCATION----------------------->
            <div id="pane_bifurcation" class="smooth-borders">
            
            <div class="2-container">
            <!--Variable To Plot : <input id="which_to_bifurcate" class="input_small" value="u">
            <button onclick="plot_bifurcation()">Show Bifurcation Diagram</button>-->
                <h1>Under Construction</h1>
            </div>
            <br>
            <br>
            </div>
            </div>
        </div>
</div>
<div id="canvas_pane" style="display:flex;position:relative">
<div>
    <canvas id="CanvasOverlay" style="width:100%;height:100%;border:blue solid 2px;background:none !important;padding:0 !important;position:absolute;left:0;top:0;" ></canvas>
</div>
<div>
    <canvas style="width:100%;height:100%;border:black solid 2px;padding:0 !important;background:none !important;position:absolute;left:0;top:0;" id="MainCanvas"></canvas>
    </div>
</div>

<script>
/*algebra.js*/
//var Fraction = algebra.Fraction;
//var Expression = algebra.Expression;
//var Equation = algebra.Equation;
/*Global Vars*/
var canvas = document.getElementById("MainCanvas");
var canvas_overlay = document.getElementById("CanvasOverlay");
canvas.width = 1000;
canvas.height = 1000;
canvas_overlay.width = canvas.width;
canvas_overlay.height = canvas.height;
var canvasWidth = canvas.width;
var canvasHeight = canvas.height;
var ctx = canvas.getContext("2d");
var overlay_ctx = canvas_overlay.getContext("2d");
var ANIMATION_MODE = true;
var PLOT_BOTH_DIRECTIONS = true;
var MOUSE_MODE = false;
var show_more_options = false;
var all_panes = ["normal_plot","bifurcation"]
function displayPane(pane){
    all_panes.forEach((pane_name)=>{
        document.getElementById("pane_"+pane_name).style.display = "none";
    });
    document.getElementById("pane_"+pane).style.display = "flex";
}
var pane = "normal_plot";
displayPane(pane);
    
function toggle_show_more_options(){
    show_more_options = !show_more_options;
    if(show_more_options){
        handle_pane_resize();
        document.getElementById("show_more_options_button").innerText = "Hide Options";
        document.getElementById("main_pane").classList.remove("move_up_anim");
        document.getElementById("main_pane").classList.add("move_down_anim");
    }else{
        document.getElementById("show_more_options_button").innerText = "Show Options";
        document.getElementById("main_pane").classList.remove("move_down_anim");
        document.getElementById("main_pane").classList.add("move_up_anim");
    }
}

toggle_show_more_options();
    
//var canvasData = ctx.getImageData(0, 0, canvasWidth, canvasHeight);

// That's how you define the value of a pixel
function drawPixel (x, y, r, g, b, a) {
    /*var index = (x + y * canvasWidth) * 4;
    canvasData.data[index + 0] = r;
    canvasData.data[index + 1] = g;
    canvasData.data[index + 2] = b;
    canvasData.data[index + 3] = a;*/
    //ctx.fillStyle = "rgba("+r.toString()+","+g.toString()+","+b.toString()+","+a.toString()+")";
    ctx.fillRect(x,y, 1,1);
}
    

// That's how you update the canvas, so that your
// modification are taken in consideration
function updateCanvas() {
    ctx.putImageData(canvasData, 0, 0);
}

function compute_runge_kutta(x_n,y_n,t_n,step_size,eq){
    let x,y,t;
    x = x_n;
    y = y_n;
    t = t_n;
    //K-1
    k_1 = eval(eq);
    //K-2
    x = x_n+step_size*k_1/2;
    y = y_n+step_size*k_1/2;
    t = t_n + step_size/2;
    k_2 = eval(eq);
    
    //K-3
    x = x_n+step_size*k_2/2;
    y = y_n+step_size*k_2/2;
    t = t_n + step_size/2;
    k_3 = eval(eq);
    
    //K-4
    x = x_n+step_size*k_3;
    y = y_n+step_size*k_3;
    t = t_n + step_size;
    k_4 = eval(eq);
    return k_1+2*k_2+2*k_3+k_4;
}
let sin = Math.sin;
let cos = Math.cos;
let tan = Math.tan;
let arcsin = Math.asin;
let arccos = Math.acos;
let arctan = Math.atan;
let asin = Math.asin;
let acos = Math.acos;
let atan = Math.atan;

x_eq = document.getElementById("x_eq").value;
y_eq = document.getElementById("y_eq").value;
variables = document.getElementById("variables").value;
x_0 = 0;
y_0 = 0;
step_size = 0.001;
num_steps = 5000;
x_lo = -5;
x_hi = 5;
y_lo = -5;
y_hi = 5;

    
function show_graph(x_eq,y_eq,x_0,y_0){
    let k_1,k_2,k_3,k_4,k_temp;
    let x_plot,y_plot;
    if(ANIMATION_MODE){
        let x_actual = x_0
        let x_actual_reversed = x_0;
        let y_actual = y_0;
        let y_actual_reversed = y_0;
        let t_actual =0;
        let t_actual_reversed = 0;
        let i = 0;
        
            let interval_id = setInterval(()=>{
                for(let j=0;j<20;j++){
                    dx = compute_runge_kutta(x_actual,y_actual,t_actual,step_size,x_eq);
                    dy = compute_runge_kutta(x_actual,y_actual,t_actual,step_size,y_eq);
                    x_actual += dx*(1/6)*step_size;
                    y_actual += dy*(1/6)*step_size;
                    t_actual = t_actual+step_size;
                    x_plot = canvasWidth * (x_actual/(x_hi-x_lo)) + canvasWidth/2;
                    y_plot = canvasHeight * (y_actual/(y_hi-y_lo)) + canvasHeight/2;
                    drawPixel(x_plot,y_plot,255,255,255,1);
                    if(PLOT_BOTH_DIRECTIONS){
                        dx = compute_runge_kutta(x_actual_reversed,y_actual_reversed,t_actual_reversed,-step_size,x_eq);
                        dy = compute_runge_kutta(x_actual_reversed,y_actual_reversed,t_actual_reversed,-step_size,y_eq);
                        x_actual_reversed += dx*(1/6)*-step_size;
                        y_actual_reversed += dy*(1/6)*-step_size;
                        t_actual_reversed = t_actual-step_size;
                        x_plot = canvasWidth * (x_actual_reversed/(x_hi-x_lo)) + canvasWidth/2;
                        y_plot = canvasHeight * (y_actual_reversed/(y_hi-y_lo)) + canvasHeight/2;
                        drawPixel(x_plot,y_plot,255,255,255,1);
                    }
                }
                i +=10;
                if(i>num_steps){
                    clearInterval(interval_id);
                }
            },0.00001);
    }else{
        let x_actual = x_0;
        let y_actual = y_0;
        let t_actual = 0;
        let i = 0;
        for(i=0;i<num_steps;i++){
            dx = compute_runge_kutta(x_actual,y_actual,t_actual,step_size,x_eq);
            dy = compute_runge_kutta(x_actual,y_actual,t_actual,step_size,y_eq);
            x_actual += dx*(1/6)*step_size;
            y_actual += dy*(1/6)*step_size;
            t_actual = t_actual+step_size;
            x_plot = canvasWidth * (x_actual/(x_hi-x_lo)) + canvasWidth/2;
            y_plot = canvasHeight * (y_actual/(y_hi-y_lo)) + canvasHeight/2;
            drawPixel(x_plot,y_plot,255,255,255,1);
        }
        if(PLOT_BOTH_DIRECTIONS){
            let x_actual = x_0;
            let y_actual = y_0;
            let t_actual = 0;
            step_size = -step_size;
            for(i=0;i<num_steps;i++){
                dx = compute_runge_kutta(x_actual,y_actual,t_actual,step_size,x_eq);
                dy = compute_runge_kutta(x_actual,y_actual,t_actual,step_size,y_eq);
                x_actual += dx*(1/6)*step_size;
                y_actual += dy*(1/6)*step_size;
                t_actual = t_actual+step_size;
                x_plot = canvasWidth * (x_actual/(x_hi-x_lo)) + canvasWidth/2;
                y_plot = canvasHeight * (y_actual/(y_hi-y_lo)) + canvasHeight/2;
                drawPixel(x_plot,y_plot,255,255,255,1);
            }
            step_size = -step_size;
        }
    }
}
    
function load_params(){
    x_eq = document.getElementById("x_eq").value;
    y_eq = document.getElementById("y_eq").value;
    x_0 = parseFloat(document.getElementById("x_0").value);
    y_0 = parseFloat(document.getElementById("y_0").value);
    x_lo = parseFloat(document.getElementById("x_min").value);;
    x_hi = parseFloat(document.getElementById("x_max").value);;
    y_lo = parseFloat(document.getElementById("y_min").value);;
    y_hi = parseFloat(document.getElementById("y_max").value);;
    variables = document.getElementById("variables").value;
    ANIMATION_MODE = document.getElementById("animation_mode_check").checked;
    PLOT_BOTH_DIRECTIONS = document.getElementById("plot_both_directions").checked;
    eval(variables);
}
canvas.onmousemove = (data)=>{
    if(MOUSE_MODE){
        let x_s = (x_hi-x_lo);
        let y_s = (y_hi-y_lo);
        let WIDTH = canvas.clientWidth;
        let HEIGHT = canvas.clientHeight;
        document.getElementById("x_0").value = 
            ((data.offsetX/WIDTH)*x_s+x_lo).toFixed(5).toString();
        document.getElementById("y_0").value = ((data.offsetY/HEIGHT)*y_s+y_lo).toFixed(5).toString();
    }
};
canvas.onmousedown = (data)=>{
    if(MOUSE_MODE){
        let x_s = (x_hi-x_lo);
        let y_s = (y_hi-y_lo);
        let WIDTH = canvas.clientWidth;
        let HEIGHT = canvas.clientHeight;
        document.getElementById("x_0").value = ((data.offsetX/WIDTH)*x_s+x_lo).toFixed(5).toString();
        document.getElementById("y_0").value = ((data.offsetY/HEIGHT)*y_s+y_lo).toFixed(5).toString();
        plot_from_initial_cond();
    }
}

function draw_bounds(){
    overlay_ctx.fillStyle = "black";
    overlay_ctx.fillRect(canvasWidth*(Math.abs(x_lo)/(x_hi-x_lo)),0,1,canvasHeight);
    overlay_ctx.fillRect(0,canvasHeight*(Math.abs(y_lo)/(y_hi-y_lo)),canvasWidth,1);
    overlay_ctx.font = "30px Arial";
    //overlay_ctx.fillText(x_lo.toFixed(2).toString(),10,canvasHeight/2,55);
    //overlay_ctx.fillText(x_hi.toFixed(2).toString(),canvasWidth-65,canvasHeight/2,55);
    //overlay_ctx.fillText(x_lo.toFixed(2).toString(),10,canvasHeight/2,55);
    //overlay_ctx.fillText(x_lo.toFixed(2).toString(),10,canvasHeight/2,55);

}
function toggle_mouse_mode(){
    MOUSE_MODE = !MOUSE_MODE;
    if(MOUSE_MODE){
        document.getElementById("mouse_mode_toggle").classList.add("active");
    }else{
        document.getElementById("mouse_mode_toggle").classList.remove("active");
    }
}
function plot_from_initial_cond(){
    load_params();
    try{
        show_graph(x_eq,y_eq,x_0,y_0);
    }catch (error){
        alert("Some variables are not defined : "+error.toString());
    }
}
function handle_pane_resize(){
    let canvas_pane = document.getElementById("canvas_pane");
    if(window.innerWidth>window.innerHeight){
        canvas_pane.style.width = window.innerHeight*0.95;
        canvas_pane.style.height  = window.innerHeight*0.95;
    }else{
        canvas_pane.style.width = window.innerWidth*0.95;
        canvas_pane.style.height = window.innerWidth*0.95;
    }
    if(show_more_options){
        let r = Math.min(1.2,parseFloat(canvas_pane.style.width)/520);
        main_functions.style.transform = "scale("+r.toString()+","+r.toString()+")";    
        main_pane.style.width = (r*500).toString()+"px";
        main_pane.style.height = (r*280).toString()+"px";
    }
}
function clear_graph(){
    load_params();
    overlay_ctx.clearRect(0,0,canvasWidth,canvasHeight);
    ctx.clearRect(0,0,canvasWidth,canvasHeight);
    overlay_ctx.fillStyle = "black";
    overlay_ctx.fillRect(canvasWidth*(Math.abs(x_lo)/(x_hi-x_lo)),0,1,canvasHeight);
    overlay_ctx.fillRect(0,canvasHeight*(Math.abs(y_lo)/(y_hi-y_lo)),canvasWidth,1);
}
    function canvas_arrow(context, fromx, fromy, tox, toy) {
        /*courtasy of Titus Cieslewski https://stackoverflow.com/questions/808826/draw-arrow-on-canvas-tag*/
  var headlen = 10; // length of head in pixels
  var dx = tox - fromx;
  var dy = toy - fromy;
  var angle = Math.atan2(dy, dx);
  context.moveTo(fromx, fromy);
  context.lineTo(tox, toy);
  context.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
  context.moveTo(tox, toy);
  context.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
}
function show_dynamics_grid(){
    let grid_size = 0.05;
    overlay_ctx.strokeStyle = "#c4c4c4"; 
    overlay_ctx.beginPath();
     let x_s = (x_hi-x_lo);
    let y_s = (y_hi-y_lo);
        let WIDTH = canvas.clientWidth;
        let HEIGHT = canvas.clientHeight;
    load_params();
    for(let i=0;i<1;i+=grid_size){
        for(let j=0;j<1;j+=grid_size){
overlay_ctx.strokeRect(i*canvasWidth,j*canvasHeight,grid_size*canvasWidth,grid_size*canvasHeight);
            let offsetX = (i+0.5*grid_size)*canvasWidth;
            let offsetY = (j+0.5*grid_size)*canvasHeight;
        let x_0 = (offsetX/WIDTH)*x_s+x_lo;
        let y_0 = (offsetY/HEIGHT)*y_s+y_lo;
        let x,y;
        x = x_0;
        y = y_0;
        //K-1
        let dx = eval(x_eq);
        let dy = eval(y_eq);
        let norm = Math.sqrt(dx*dx+dy*dy);
        let arrow_size = grid_size*canvasWidth*0.006;
        let x_to = x_0 + dx/norm * arrow_size;
        let y_to = y_0 + dy/norm * arrow_size;
        x_to = ((x_to-x_lo)/x_s)*WIDTH;
        y_to = ((y_to-y_lo)/y_s)*HEIGHT;
        canvas_arrow(overlay_ctx, offsetX, offsetY, x_to, y_to);
        }
    }
    overlay_ctx.stroke();
}
function plot_null_clines(plot_equilibrium){
    load_params();
    let step_n = 0.001;
    for(let x_step=0;x_step<1;x_step+=step_n){
        for(let y_step=0;y_step<1;y_step+=step_n){
            x = x_lo + x_step*(x_hi-x_lo);
            y = y_lo + y_step*(y_hi-y_lo);
            //K-1
            let x_out = eval(x_eq);
            let y_out = eval(y_eq);
            if(!plot_equilibrium && Math.abs(x_out)<=0.01 && Math.abs(y_out) >= 0.01){
                overlay_ctx.fillStyle = "red";
                let x_plot = canvasWidth * (x/(x_hi-x_lo)) + canvasWidth/2;
                let y_plot = canvasHeight * (y/(y_hi-y_lo)) + canvasHeight/2;
                overlay_ctx.fillRect(x_plot,y_plot,1,1);    
            }else if(!plot_equilibrium && Math.abs(y_out)<= 0.01 && Math.abs(x_out)>= 0.01){
                overlay_ctx.fillStyle = "yellow";
                let x_plot = canvasWidth * (x/(x_hi-x_lo)) + canvasWidth/2;
                let y_plot = canvasHeight * (y/(y_hi-y_lo)) + canvasHeight/2;
                overlay_ctx.fillRect(x_plot,y_plot,1,1);   
            }else if(plot_equilibrium && Math.abs(y_out)<= 0.01 && Math.abs(x_out)<= 0.01){
                overlay_ctx.fillStyle = "black";
                let x_plot = canvasWidth * (x/(x_hi-x_lo)) + canvasWidth/2;
                let y_plot = canvasHeight * (y/(y_hi-y_lo)) + canvasHeight/2;
                  ctx.beginPath();
                  ctx.arc(x_plot,y_plot, 5, 0, 2 * Math.PI, false);
                  ctx.fill();
                  ctx.lineWidth = 5;
            }
        }
    }
}
    function plot_bifurcation(){
    load_params();
    let step_n = 0.001;
    let delta = 0.01;
    let i = 0;
    let a = setInterval(()=>{
        for(let k=0;k<100;k++){
            let y = 0;
            let x = x_lo + Math.random()*(x_hi-x_lo);
            let t = 0;
            let u = x_lo + i*(x_hi-x_lo);
            for(let j=0;j<200;j++){
                x = eval(x_eq);
            }
            ctx.fillStyle = "black";
            let x_plot = canvasWidth * (u/(x_hi-x_lo)) + canvasWidth/2;
            let y_plot = canvasHeight * (x/(y_hi-y_lo)) + canvasHeight/2;
            ctx.fillRect(x_plot,y_plot,1,1);
        }
        
        if(i>1){
            clearInterval(a);
        }else{
            i+=step_n;
        }
    },0.001)
}
window.onmousewheel = ($event)=>{
    return;
    overlay_ctx.clearRect(0,0,canvasWidth,canvasHeight);
    let s = 1;
    if(event.deltaY>0){
        s = 0.9;
    }else{
        s = 1.1;
    }
    x_lo = x_lo * s;
    y_lo = y_lo * s;
    x_hi = x_hi * s;
    y_hi = y_hi * s;
    draw_bounds();
};
window.onresize = ()=>{
    handle_pane_resize();
}
document.getElementById("pane_select").onchange = ()=>{
  displayPane(document.getElementById("pane_select").value);  
};
document.getElementById("step_amount").onchange = ()=>{
  document.getElementById("step_amount_val").innerText = document.getElementById("step_amount").value.toString();  
  num_steps = parseFloat(document.getElementById("step_amount").value);
};
document.getElementById("step_size").onchange = ()=>{
    step_size = parseFloat(document.getElementById("step_size").value);
};
ctx.clearRect(0,0,canvasWidth,canvasHeight);
draw_bounds();
handle_pane_resize();
toggle_mouse_mode();
//toggle_show_more_options();
</script>